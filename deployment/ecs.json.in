{
    "family": "noms",
    "taskRoleArn": "arn:aws:iam::337712362153:role/ecsTaskS3Everything",
    "containerDefinitions": [
        {
            "name": "noms-src",
            "image": "corydodt/noms-src:noms-21-nomsbook",

            "memory": 1,
            "essential": false,
            "cpu": 0
        },
        {
            "name": "noms-main",
            "image": "corydodt/noms-main:noms-21-nomsbook",

            "volumesFrom": [
                { "sourceContainer": "noms-src" }
            ],
            "memory": 500,
            "portMappings": [
                {
                    "hostPort": 8080,
                    "containerPort": 8080,
                    "protocol": "tcp"
                }
            ],
            "essential": true,
            "links": [ "mongo" ],
            "command": [ "noms" ],
            "cpu": 0,
            "environment": [
                { "name": "NOMS_DB_HOST", "value": "mongo" },
                { "name": "NOMS_VERSION", "value": "noms-21-nomsbook" }
            ]
        },
        {
            "name": "mongo",
            "image": "mongo",

            "memory": 400,
            "hostname": "mongo",
            "essential": true,
            "cpu": 0
        },
        {
            "name": "nginx-letsencrypt-s3",
            "image": "corydodt/nginx-letsencrypt-s3:noms-21-nomsbook",

            "memory": "100",
            "essential": true,
            "portMappings": [
                {
                    "hostPort": "80",
                    "containerPort": "80",
                    "protocol": "tcp"
                },
                {
                    "hostPort": "443",
                    "containerPort": "443",
                    "protocol": "tcp"
                }
            ],
            "environment": [
                {% macro evar(name) -%}
                { "name": "{{ name }}", "value": "{{ __environ__[name] }}" }
                {%- endmacro -%}

                {{ evar('NOMS_VERSION') }},
                {{ evar('NOMS_DB_HOST') }},
                {{ evar('certbot_flags') }},
                {{ evar('certbot_email') }},
                {{ evar('public_hostname') }},
                {{ evar('proxy_hostname') }},
                {{ evar('proxy_port') }}
            ],
            "links": [ "noms-main" ]
        }
    ],
    "networkMode": "bridge"
}
